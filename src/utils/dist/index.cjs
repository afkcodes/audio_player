"use strict";function e(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(t){if(Array.isArray(t))return e(t)}function n(e,t,n,r,a,i,o){try{var u=e[i](o);var l=u.value}catch(e){n(e);return}if(u.done){t(l)}else{Promise.resolve(l).then(r,a)}}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,i){var o=e.apply(t,r);function u(e){n(o,a,i,u,l,"next",e)}function l(e){n(o,a,i,u,l,"throw",e)}u(undefined)})}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function o(e,t,n){if(t)i(e.prototype,t);if(n)i(e,n);return e}function u(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function l(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var r=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}r.forEach(function(t){u(e,t,n[t])})}return e}function d(e){return t(e)||l(e)||E(e)||c()}function f(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function E(t,n){if(!t)return;if(typeof t==="string")return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(r);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}function v(e,t){var n,r,a,i,o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(e){return function(t){return l([e,t])}}function l(i){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(a=i[0]&2?r["return"]:i[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;if(r=0,a)i=[i[0]&2,a.value];switch(i[0]){case 0:case 1:a=i;break;case 4:o.label++;return{value:i[1],done:false};case 5:o.label++;r=i[1];i=[0];continue;case 7:i=o.ops.pop();o.trys.pop();continue;default:if(!(a=o.trys,a=a.length>0&&a[a.length-1])&&(i[0]===6||i[0]===2)){o=0;continue}if(i[0]===3&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(i[0]===6&&o.label<a[1]){o.label=a[1];a=i;break}if(a&&o.label<a[2]){o.label=a[2];o.ops.push(i);break}if(a[2])o.ops.pop();o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e];r=0}finally{n=a=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}}var A=Object.defineProperty;var y=function(e,t,n){return t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var _=function(e,t){return A(e,"name",{value:t,configurable:!0})};var p=function(e,t,n){return y(e,(typeof t==="undefined"?"undefined":f(t))!="symbol"?t+"":t,n),n};var b=Object.freeze({REACT:"REACT",VANILLA:"VANILLA",DEVELOPMENT:"development"}),T=Object.freeze({BUFFERING:"buffering",PLAYING:"playing",PAUSED:"paused",READY:"ready",IDLE:"idle",ENDED:"ended",STALLED:"stalled",ERROR:"error",TRACK_CHANGE:"trackchanged"}),D=Object.freeze({MEDIA_ERR_ABORTED:"The user canceled the audio.",MEDIA_ERR_DECODE:"An error occurred while decoding the audio.",MEDIA_ERR_NETWORK:"A network error occurred while fetching the audio.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The audio is missing or is in a format not supported by your browser.",DEFAULT:"An unknown error occurred."});var h,m=(h=function(){function e(){a(this,e)}o(e,null,[{key:"validateEventName",value:function e(e){if(!e||typeof e!="string")throw new Error("Invalid event name")}},{key:"notify",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"audiox_notifier_default";this.validateEventName(e);var r=h.listeners[e];r&&t!==null&&(h.notifierState[e]=s({},h.notifierState[e]||{},t),r.forEach(function(t){t(h.notifierState[e])}))}},{key:"listen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),typeof t!="function")throw new Error("Callback must be a function");return h.listeners[e]?h.listeners[e].add(t):(h.notifierState[e]=n,h.listeners[e]=new Set([t])),function(){var n=h.listeners[e];n&&(n.delete(t),n.size===0&&delete h.listeners[e])}}},{key:"multiListen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),!Array.isArray(t)||t.length===0)throw new Error("Callbacks must be a non-empty array of functions");var r=t.map(function(t){return h.listen(e,t,n)});return function(){r.forEach(function(e){return e()})}}},{key:"getLatestState",value:function e(e){return this.validateEventName(e),h.notifierState[e]}}]);return e}(),_(h,"ChangeNotifier"),p(h,"listeners",{}),p(h,"notifierState",{}),h),R=m;var O=_(function(e){return e&&Array.isArray(e)&&e.length},"isValidArray");var g=_(function(e){var t;var n="";switch((t=e.error)===null||t===void 0?void 0:t.code){case MediaError.MEDIA_ERR_ABORTED:n+=D.MEDIA_ERR_ABORTED;break;case MediaError.MEDIA_ERR_NETWORK:n+=D.MEDIA_ERR_NETWORK;break;case MediaError.MEDIA_ERR_DECODE:n+=D.MEDIA_ERR_DECODE;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:n+=D.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:n+=D.DEFAULT;break}return n},"getReadableErrorMessage"),S=_(function(e){var t;var n=e.title,r=e.album,a=e.artist,i=e.artwork,o=i?(t=i[0])===null||t===void 0?void 0:t.src:"",u=["96x96","128x128","192x192","256x256","384x384","512x512"].map(function(e){return{src:o,sizes:e,type:"image/png"}});return{title:n,album:r,artist:a,artwork:u}},"metaDataCreator"),k=0,I=_(function(e,t){var n=new Set;for(var r=0;r<e.played.length;r++){var a=e.played.start(r),i=e.played.end(r)-a;n.add(i)}var o=d(n).reduce(function(e,t){return e+t},0);k=["ENDED","TRACK_CHANGE","PAUSE"].includes(t)?o:k,R.notify("AUDIO_STATE",{currentTrackPlayTime:o,previousTrackPlayTime:k})},"calculateActualPlayedLength");var N=Object.freeze({1:"MEDIA_ERR_ABORTED",3:"MEDIA_ERR_DECODE",2:"MEDIA_ERR_NETWORK",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"});var U=R,P={LOADED_META_DATA:function(e,t){var n;U.notify("AUDIO_STATE",{playbackState:T.BUFFERING,duration:(n=t)===null||n===void 0?void 0:n.duration,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_state_".concat(e.type))},CAN_PLAY:function(e){U.notify("AUDIO_STATE",{playbackState:T.BUFFERING,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},CAN_PLAY_THROUGH:function(e){U.notify("AUDIO_STATE",{playbackState:T.READY,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},PLAY:function(e,t){var n;U.notify("AUDIO_STATE",{playbackState:T.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},PAUSE:function(e,t,n){var r;U.notify("AUDIO_STATE",{playbackState:T.PAUSED,progress:(r=t)===null||r===void 0?void 0:r.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&I(t,"PAUSE")},ENDED:function(e,t,n){var r;U.notify("AUDIO_STATE",{playbackState:T.ENDED,progress:(r=t)===null||r===void 0?void 0:r.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&I(t,"ENDED")},ERROR:function(e,t){var n;var r=(n=t.error)===null||n===void 0?void 0:n.code,a=g(t);U.notify("AUDIO_STATE",{playbackState:T.ERROR,error:{code:r,message:N[r],readable:a}},"audiox_baseEvents_state_".concat(e.type))},TIME_UPDATE:function(e,t){var n;var r=R.getLatestState("AUDIO_X_STATE");U.notify("AUDIO_STATE",{playbackState:t.paused?r.playbackState:T.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},WAITING:function(e,t){var n;U.notify("AUDIO_STATE",{playbackState:T.BUFFERING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},VOLUME_CHANGE:function(e){U.notify("AUDIO_STATE",{},"audiox_baseEvents_state")}};var w=Object.freeze({ABORT:"abort",TIME_UPDATE:"timeupdate",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",PLAYING:"playing",WAITING:"waiting",SEEKING:"seeking",SEEKED:"seeked",LOADED_META_DATA:"loadedmetadata",LOADED_DATA:"loadeddata",PLAY:"play",PAUSE:"pause",RATE_CHANGE:"ratechange",VOLUME_CHANGE:"volumechange",SUSPEND:"suspend",STALLED:"stalled",PROGRESS:"progress",LOAD_START:"loadstart",ERROR:"error",TRACK_CHANGE:"trackchange"});var L=_(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=F.getAudioInstance();O(Object.keys(e))&&Object.keys(e).forEach(function(r){var a;var i=r;(a=n)===null||a===void 0?void 0:a.addEventListener(w[i],function(a){if(r&&e[i]){var o=e[i];typeof o=="function"&&o(a,n,t)}})})},"attachDefaultEventListeners"),M=_(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=F.getAudioInstance();O(e)&&e.forEach(function(e){var r;var a=e;Object.keys(w).includes(a)&&((r=n)===null||r===void 0?void 0:r.addEventListener(w[a],function(e){R.notify(w[a],{e:e,audioInstance:n,enablePlayLog:t})}))})},"attachCustomEventListeners");var C=_(function(e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(S(e)))},"updateMetaData"),H=_(function(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",function(){F.getAudioInstance().play()}),navigator.mediaSession.setActionHandler("pause",function(){F.getAudioInstance().pause()}))},"attachMediaSessionHandlers");var G={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},x={playbackState:T.IDLE,duration:0,bufferedDuration:0,progress:0,volume:50,playbackRate:1,error:{code:null,message:"",readable:""},currentTrack:{},currentTrackPlayTime:0,previousTrackPlayTime:0};R.listen("AUDIO_STATE",function(e){R.notify("AUDIO_X_STATE",s({},x,e))},x);var j,V=R,Y,F=(Y=function(){function e(){a(this,e);var t;p(this,"_audio");p(this,"isPlayLogEnabled");if(Y._instance)return Y._instance;if(process.env.NODE_ENV!==((t=b)===null||t===void 0?void 0:t.DEVELOPMENT)&&j)throw new Error("Cannot create multiple audio instance");Y._instance=this,this._audio=new Audio}o(e,[{key:"init",value:function e(e){var t=this;return r(function(){var n,r,a,i,o,u,l,c,s,d,f,E,A;return v(this,function(v){r=e.preloadStrategy,a=r===void 0?"auto":r,i=e.autoplay,o=i===void 0?!1:i,u=e.useDefaultEventListeners,l=u===void 0?!0:u,c=e.customEventListeners,s=c===void 0?null:c,d=e.showNotificationActions,f=d===void 0?!1:d,E=e.enablePlayLog,A=E===void 0?!1:E;(n=t._audio)===null||n===void 0?void 0:n.setAttribute("id","audio_x_instance"),t._audio.preload=a,t._audio.autoplay=o,t.isPlayLogEnabled=A,j=t._audio,(l||s==null)&&L(P,A),f&&H();return[2]})})()}},{key:"addMedia",value:function e(e){var t=this;return r(function(){return v(this,function(n){t.isPlayLogEnabled&&I(j,"TRACK_CHANGE"),e&&(j.src=e.source,V.notify("AUDIO_STATE",{playbackState:T.TRACK_CHANGE,currentTrackPlayTime:0,currentTrack:e}),C(e),j.load());return[2]})})()}},{key:"play",value:function e(){return r(function(){var e,t,n;return v(this,function(r){switch(r.label){case 0:t=j.src!=="";n=((e=j)===null||e===void 0?void 0:e.paused)&&j.HAVE_ENOUGH_DATA===G.HAVE_ENOUGH_DATA&&t;if(!n)return[3,2];return[4,j.play()];case 1:n=r.sent();r.label=2;case 2:n;return[2]}})})()}},{key:"addMediaAndPlay",value:function e(e){var t=this;return r(function(){return v(this,function(n){e&&t.addMedia(e).then(function(){j.HAVE_ENOUGH_DATA===G.HAVE_ENOUGH_DATA&&setTimeout(r(function(){return v(this,function(e){switch(e.label){case 0:return[4,t.play()];case 1:e.sent();return[2]}})}),950)});return[2]})})()}},{key:"pause",value:function e(){var e,t;j&&!((e=j)===null||e===void 0?void 0:e.paused)&&((t=j)===null||t===void 0?void 0:t.pause())}},{key:"stop",value:function e(){var e;j&&!j.paused&&((e=j)===null||e===void 0?void 0:e.pause(),j.currentTime=0)}},{key:"reset",value:function e(){var e=this;return r(function(){return v(this,function(t){j&&(e.stop(),j.src="",j.srcObject=null);return[2]})})()}},{key:"setVolume",value:function e(e){var t=e/100;j&&(j.volume=t,V.notify("AUDIO_STATE",{volume:e}))}},{key:"setPlaybackRate",value:function e(e){j&&(j.playbackRate=e,V.notify("AUDIO_STATE",{playbackRate:e}))}},{key:"mute",value:function e(){j&&!j.muted&&(j.muted=!0)}},{key:"seek",value:function e(e){j&&(j.currentTime=e)}},{key:"destroy",value:function e(){var e=this;return r(function(){var t;return v(this,function(n){switch(n.label){case 0:t=j;if(!t)return[3,2];return[4,e.reset()];case 1:t=(n.sent(),j.removeAttribute("src"),j.load());n.label=2;case 2:t;return[2]}})})()}},{key:"subscribe",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return V.listen(e,t,n)}},{key:"attachEventListeners",value:function e(e){M(e)}},{key:"id",get:function e(){var e;return(e=j)===null||e===void 0?void 0:e.getAttribute("id")}},{key:"media",set:function e(e){var t;j&&(j.src=(t=e)===null||t===void 0?void 0:t.source)}}],[{key:"getAudioInstance",value:function e(){return j}}]);return e}(),_(Y,"AudioX"),p(Y,"_instance"),Y);exports.AUDIO_EVENTS=w;exports.AUDIO_STATE=x;exports.AUDIO_X_CONSTANTS=b;exports.AudioX=F;//# sourceMappingURL=index.cjs.map