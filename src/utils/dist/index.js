var H=Object.defineProperty;var J=(t,e,a)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var r=(t,e)=>H(t,"name",{value:e,configurable:!0});var c=(t,e,a)=>(J(t,typeof e!="symbol"?e+"":e,a),a);var M=[{frequency:31,type:"lowshelf",gain:0},{frequency:63,type:"peaking",gain:0},{frequency:125,type:"peaking",gain:0},{frequency:250,type:"peaking",gain:0},{frequency:500,type:"peaking",gain:0},{frequency:1e3,type:"peaking",gain:0},{frequency:2e3,type:"peaking",gain:0},{frequency:4e3,type:"peaking",gain:0},{frequency:8e3,type:"peaking",gain:0},{frequency:16e3,type:"highshelf",gain:0}];var _,U=(_=class{constructor(){c(this,"audioCtx");c(this,"audioCtxStatus");c(this,"eqFilterBands");if(_._instance)return console.warn("Instantiation failed: cannot create multiple instance of Equalizer returning existing instance"),_._instance;if(this.audioCtx===void 0&&typeof AudioContext<"u"?(this.audioCtx=new AudioContext,this.audioCtxStatus="ACTIVE",this.init()):(console.log("Equalizer not initialized, AudioContext failed"),this.audioCtxStatus="FAILED"),this.audioCtxStatus==="ACTIVE"&&this.audioCtx.state==="suspended"){var e=r(()=>{this.audioCtx.resume(),setTimeout(()=>{this.audioCtx.state==="running"&&document.body.removeEventListener("click",e,!1);},0);},"resume");document.body.addEventListener("click",e,!1);}_._instance=this;}init(){try{let e=u.getAudioInstance(),a=this.audioCtx.createMediaElementSource(e),s=M.map(o=>{let i=this.audioCtx.createBiquadFilter();return i.type=o.type,i.frequency.value=o.frequency,i.gain.value=o.gain,i.Q.value=1,i});a.connect(s[0]);for(let o=0;o<s.length-1;o++)s[o].connect(s[o+1]);s[s.length-1].connect(this.audioCtx.destination),this.audioCtxStatus="ACTIVE",this.eqFilterBands=s;}catch{this.audioCtxStatus="FAILED";}}setPreset(){console.log("AudioContext",this.audioCtxStatus);}getPreset(){return this.eqFilterBands}status(){return this.audioCtx.state==="suspended"&&this.audioCtx.resume(),this.audioCtxStatus}},r(_,"Equalizer"),c(_,"_instance"),_);var N=Object.freeze({REACT:"REACT",VANILLA:"VANILLA",DEVELOPMENT:"development"}),E=Object.freeze({BUFFERING:"buffering",PLAYING:"playing",PAUSED:"paused",READY:"ready",IDLE:"idle",ENDED:"ended",STALLED:"stalled",ERROR:"error",TRACK_CHANGE:"trackchanged"}),h=Object.freeze({MEDIA_ERR_ABORTED:"The user canceled the audio.",MEDIA_ERR_DECODE:"An error occurred while decoding the audio.",MEDIA_ERR_NETWORK:"A network error occurred while fetching the audio.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The audio is missing or is in a format not supported by your browser.",DEFAULT:"An unknown error occurred."}),G={HLS:"https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"};var l,Z=(l=class{static validateEventName(e){if(!e||typeof e!="string")throw new Error("Invalid event name")}static notify(e,a,s="audiox_notifier_default"){this.validateEventName(e);let o=l.listeners[e];o&&a!==null&&(console.log(`NOTIFYING TO EVENT : ${e} - CALLER : ${s}`),l.notifierState[e]={...l.notifierState[e]||{},...a},o.forEach(i=>{i(l.notifierState[e]);}));}static listen(e,a,s={}){if(this.validateEventName(e),typeof a!="function")throw new Error("Callback must be a function");return l.listeners[e]?l.listeners[e].add(a):(l.notifierState[e]=s,l.listeners[e]=new Set([a])),()=>{let o=l.listeners[e];if(!o){console.log(`EVENT NOT FOUND : ${e}`);return}console.log(`REMOVING EVENT LISTENER FOR EVENT : ${e}`),o.delete(a),o.size===0&&delete l.listeners[e];}}static multiListen(e,a,s={}){if(this.validateEventName(e),!Array.isArray(a)||a.length===0)throw new Error("Callbacks must be a non-empty array of functions");let o=a.map(i=>l.listen(e,i,s));return ()=>{o.forEach(i=>i());}}static getLatestState(e){return this.validateEventName(e),l.notifierState[e]}},r(l,"ChangeNotifier"),c(l,"listeners",{}),c(l,"notifierState",{}),l),A=Z;var x={ERROR:(t,e)=>{let a=e.type,s=e.details,o=e.fatal;console.log("STATUS",t.type),A.notify("AUDIO_STATE",{playbackState:E.ERROR,error:{type:a,isFatal:o,detail:s}},`audiox_baseEvents_state_${t.type}`);},FRAG_CHANGED:()=>{console.log("FRAG_CHANGED");}};var m=r(t=>t&&Array.isArray(t)&&t.length,"isValidArray");var w={},k=r(t=>{let e="";switch(t.error?.code){case MediaError.MEDIA_ERR_ABORTED:e+=h.MEDIA_ERR_ABORTED;break;case MediaError.MEDIA_ERR_NETWORK:e+=h.MEDIA_ERR_NETWORK;break;case MediaError.MEDIA_ERR_DECODE:e+=h.MEDIA_ERR_DECODE;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:e+=h.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:e+=h.DEFAULT;break}return e},"getReadableErrorMessage"),B=r(t=>{let{title:e,album:a,artist:s,artwork:o}=t,i=o?o[0]?.src:"",S=["96x96","128x128","192x192","256x256","384x384","512x512"].map(C=>({src:i,sizes:C,type:"image/png"}));return {title:e,album:a,artist:s,artwork:S}},"metaDataCreator"),P=0,R=r((t,e)=>{let a=new Set;for(let i=0;i<t.played.length;i++){let d=t.played.start(i),D=t.played.end(i)-d;a.add(D);}let o=[...a].reduce((i,d)=>i+d,0);P=["ENDED","TRACK_CHANGE","PAUSE"].includes(e)?o:P,A.notify("AUDIO_STATE",{currentTrackPlayTime:o,previousTrackPlayTime:P});},"calculateActualPlayedLength"),V=r((t,e,a)=>new Promise((s,o)=>{if(window instanceof Window&&window.document)if(w[a])e(),s();else {w[a]=!0;let i=document.createElement("script");i.type="text/javascript",i.src=t,i.async=!0,i.onload=()=>{e(),s();},document.head.appendChild(i);}else o(`Window not ready unable to initialize ${a}`);}),"loadScript");var g=Object.freeze({ABORT:"abort",TIME_UPDATE:"timeupdate",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",PLAYING:"playing",WAITING:"waiting",SEEKING:"seeking",SEEKED:"seeked",LOADED_META_DATA:"loadedmetadata",LOADED_DATA:"loadeddata",PLAY:"play",PAUSE:"pause",RATE_CHANGE:"ratechange",VOLUME_CHANGE:"volumechange",SUSPEND:"suspend",STALLED:"stalled",PROGRESS:"progress",LOAD_START:"loadstart",ERROR:"error",TRACK_CHANGE:"trackchange"}),v={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACKS_CLEARED:"hlsSubtitleTracksCleared",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached",BACK_BUFFER_REACHED:"hlsBackBufferReached"};var K=r((t,e=!1)=>{let a=u.getAudioInstance();m(Object.keys(t))&&Object.keys(t).forEach(s=>{let o=s;a?.addEventListener(g[o],i=>{if(s&&t[o]){let d=t[o];typeof d=="function"&&d(i,a,e);}});});},"attachDefaultEventListeners"),q=r((t,e=!1)=>{let a=u.getAudioInstance();m(t)&&t.forEach(s=>{let o=s;Object.keys(g).includes(o)&&a?.addEventListener(g[o],i=>{A.notify(g[o],{e:i,audioInstance:a,enablePlayLog:e});});});},"attachCustomEventListeners"),Y=r((t,e=!1)=>{let s=new y().getHlsInstance();m(Object.keys(t))&&Object.keys(t).forEach(o=>{let i=o;s.on(v[i],(d,S)=>{if(i&&t[i]){let D=t[i];typeof D=="function"&&D(d,S,s,e);}});});},"attachHlsEventsListeners");var I,f,ee=(f=class{constructor(){c(this,"HlsClass");if(f._instance)return console.warn("Instantiation failed: cannot create multiple instance of HLS returning existing instance"),f._instance;f._instance=this;}async load(){return await V(G.HLS,()=>{console.log("HLS Loaded");},"hls").then(()=>{this.HlsClass=window.Hls,window.Hls=void 0;}).catch(e=>{console.log(e);}),this.HlsClass}async init(e={},a){let s=await this.load();s.isSupported()&&(I=new s(e),Y(x,a));}addHlsMedia(e){let a=this.HlsClass,s=u.getAudioInstance();I.attachMedia(s),I.on(a.Events.MEDIA_ATTACHED,function(){I.loadSource(e.source),console.log("hls media attached");});}getHlsInstance(){return I}},r(f,"HlsAdapter"),c(f,"_instance"),f),y=ee;var X=Object.freeze({1:"MEDIA_ERR_ABORTED",3:"MEDIA_ERR_DECODE",2:"MEDIA_ERR_NETWORK",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"});var T=A,z={LOADED_META_DATA:(t,e)=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.BUFFERING,duration:e?.duration,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_state_${t.type}`);},CAN_PLAY:t=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.BUFFERING,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`);},CAN_PLAY_THROUGH:t=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.READY,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`);},PLAY:(t,e)=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.PLAYING,progress:e?.currentTime,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`);},PAUSE:(t,e,a)=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.PAUSED,progress:e?.currentTime,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`),a&&R(e,"PAUSE");},ENDED:(t,e,a)=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.ENDED,progress:e?.currentTime,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`),a&&R(e,"ENDED");},ERROR:(t,e)=>{console.log("STATUS",t.type);let a=e.error?.code,s=k(e);T.notify("AUDIO_STATE",{playbackState:E.ERROR,error:{code:a,message:X[a],readable:s}},`audiox_baseEvents_state_${t.type}`);},TIME_UPDATE:(t,e)=>{console.log("STATUS",t.type);let a=A.getLatestState("AUDIO_X_STATE");T.notify("AUDIO_STATE",{playbackState:e.paused?a.playbackState:E.PLAYING,progress:e?.currentTime,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`);},WAITING:(t,e)=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{playbackState:E.BUFFERING,progress:e?.currentTime,error:{code:null,message:"",readable:""}},`audiox_baseEvents_state_${t.type}`);},VOLUME_CHANGE:t=>{console.log("STATUS",t.type),T.notify("AUDIO_STATE",{},"audiox_baseEvents_state");}};var j=r(t=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(B(t)));},"updateMetaData"),W=r(()=>{"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",()=>{u.getAudioInstance().play();}),navigator.mediaSession.setActionHandler("pause",()=>{u.getAudioInstance().pause();}));},"attachMediaSessionHandlers");var F={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},b={playbackState:E.IDLE,duration:0,bufferedDuration:0,progress:0,volume:50,playbackRate:1,error:{code:null,message:"",readable:""},currentTrack:{},currentTrackPlayTime:0,previousTrackPlayTime:0};A.listen("AUDIO_STATE",t=>{A.notify("AUDIO_X_STATE",{...b,...t});},b);var n,L=A,p,u=(p=class{constructor(){c(this,"_audio");c(this,"isPlayLogEnabled");c(this,"eqStatus");if(p._instance)return console.warn("Instantiation failed: cannot create multiple instance of AudioX returning existing instance"),p._instance;if(process.env.NODE_ENV!==N?.DEVELOPMENT&&n)throw new Error("Cannot create multiple audio instance");p._instance=this,this._audio=new Audio,n=this._audio;}async init(e){let{preloadStrategy:a="auto",autoPlay:s=!1,useDefaultEventListeners:o=!0,customEventListeners:i=null,showNotificationActions:d=!1,enablePlayLog:S=!1,enableHls:D=!1,enableEQ:C=!1,crossOrigin:$="anonymous",hlsConfig:Q={}}=e;if(this._audio?.setAttribute("id","audio_x_instance"),this._audio.preload=a,this._audio.autoplay=s,this._audio.crossOrigin=$,this.isPlayLogEnabled=S,(o||i==null)&&K(z,S),d&&W(),C)try{let O=new U;this.eqStatus=O.status();}catch{console.log("failed to enable equalizer");}D&&new y().init(Q,S);}async addMedia(e){if(!e)return;let a=e.source.includes(".m3u8")?"HLS":"DEFAULT";if(this.isPlayLogEnabled&&R(n,"TRACK_CHANGE"),a==="HLS"){let s=new y,o=s.getHlsInstance();o?(o.detachMedia(),s.addHlsMedia(e)):(console.warn("The source provided seems to be a HLS stream but, hls playback is not enabled. Please have a look at init method of AudioX"),await this.reset());}else n.src=e.source;L.notify("AUDIO_STATE",{playbackState:E.TRACK_CHANGE,currentTrackPlayTime:0,currentTrack:e}),j(e),n.load();}async play(){let e=n.src!=="";n?.paused&&n.HAVE_ENOUGH_DATA===F.HAVE_ENOUGH_DATA&&e&&await n.play().then(()=>{console.log("PLAYING");}).catch(()=>{console.warn("cancelling current audio playback, track changed");});}async addMediaAndPlay(e){try{e&&this.addMedia(e).then(()=>{n.HAVE_ENOUGH_DATA===F.HAVE_ENOUGH_DATA&&setTimeout(async()=>{await this.play();},950);});}catch{console.log("PLAYBACK FAILED");}}pause(){n&&!n?.paused&&n?.pause();}stop(){n&&!n.paused&&(n?.pause(),n.currentTime=0);}async reset(){n&&(this.stop(),n.src="",n.srcObject=null);}setVolume(e){let a=e/100;n&&(n.volume=a,L.notify("AUDIO_STATE",{volume:e}));}setPlaybackRate(e){n&&(n.playbackRate=e,L.notify("AUDIO_STATE",{playbackRate:e}));}mute(){n&&!n.muted&&(n.muted=!0);}seek(e){n&&(n.currentTime=e);}async destroy(){n&&(await this.reset(),n.removeAttribute("src"),n.load());}subscribe(e,a,s={}){return L.listen(e,a,s)}attachEventListeners(e){q(e);}getPreset(){let e=new U;return console.log(this.eqStatus),e.getPreset()}get id(){return n?.getAttribute("id")}static getAudioInstance(){return n}},r(p,"AudioX"),c(p,"_instance"),p);

export { g as AUDIO_EVENTS, b as AUDIO_STATE, N as AUDIO_X_CONSTANTS, u as AudioX };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map