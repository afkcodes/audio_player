function e(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function t(t){if(Array.isArray(t))return e(t)}function n(e,t,n,a,r,o,i){try{var l=e[o](i);var u=l.value}catch(e){n(e);return}if(l.done){t(u)}else{Promise.resolve(u).then(a,r)}}function a(e){return function(){var t=this,a=arguments;return new Promise(function(r,o){var i=e.apply(t,a);function l(e){n(i,r,o,l,u,"next",e)}function u(e){n(i,r,o,l,u,"throw",e)}l(undefined)})}}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function i(e,t,n){if(t)o(e.prototype,t);if(n)o(e,n);return e}function l(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function u(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var a=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}a.forEach(function(t){l(e,t,n[t])})}return e}function E(e){return t(e)||u(e)||A(e)||s()}function d(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function A(t,n){if(!t)return;if(typeof t==="string")return e(t,n);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor)a=t.constructor.name;if(a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,n)}function f(e,t){var n,a,r,o,i={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),"throw":l(1),"return":l(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,a&&(r=o[0]&2?a["return"]:o[0]?a["throw"]||((r=a["return"])&&r.call(a),0):a.next)&&!(r=r.call(a,o[1])).done)return r;if(a=0,r)o=[o[0]&2,r.value];switch(o[0]){case 0:case 1:r=o;break;case 4:i.label++;return{value:o[1],done:false};case 5:i.label++;a=o[1];o=[0];continue;case 7:o=i.ops.pop();i.trys.pop();continue;default:if(!(r=i.trys,r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){i=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(o[0]===6&&i.label<r[1]){i.label=r[1];r=o;break}if(r&&i.label<r[2]){i.label=r[2];i.ops.push(o);break}if(r[2])i.ops.pop();i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e];a=0}finally{n=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}import _ from"hls.js";var T=Object.defineProperty;var v=function(e,t,n){return t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var D=function(e,t){return T(e,"name",{value:t,configurable:!0})};var y=function(e,t,n){return v(e,(typeof t==="undefined"?"undefined":d(t))!="symbol"?t+"":t,n),n};var h=Object.freeze({REACT:"REACT",VANILLA:"VANILLA",DEVELOPMENT:"development"}),S=Object.freeze({BUFFERING:"buffering",PLAYING:"playing",PAUSED:"paused",READY:"ready",IDLE:"idle",ENDED:"ended",STALLED:"stalled",ERROR:"error",TRACK_CHANGE:"trackchanged"}),p=Object.freeze({MEDIA_ERR_ABORTED:"The user canceled the audio.",MEDIA_ERR_DECODE:"An error occurred while decoding the audio.",MEDIA_ERR_NETWORK:"A network error occurred while fetching the audio.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The audio is missing or is in a format not supported by your browser.",DEFAULT:"An unknown error occurred."});var R,b=(R=function(){"use strict";function e(){r(this,e)}i(e,null,[{key:"validateEventName",value:function e(e){if(!e||typeof e!="string")throw new Error("Invalid event name")}},{key:"notify",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"audiox_notifier_default";this.validateEventName(e);var a=R.listeners[e];a&&t!==null&&(console.log("NOTIFYING TO EVENT : ".concat(e," - CALLER : ").concat(n)),R.notifierState[e]=c({},R.notifierState[e]||{},t),a.forEach(function(t){t(R.notifierState[e])}))}},{key:"listen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),typeof t!="function")throw new Error("Callback must be a function");return R.listeners[e]?R.listeners[e].add(t):(R.notifierState[e]=n,R.listeners[e]=new Set([t])),function(){var n=R.listeners[e];if(!n){console.log("EVENT NOT FOUND : ".concat(e));return}console.log("REMOVING EVENT LISTENER FOR EVENT : ".concat(e)),n.delete(t),n.size===0&&delete R.listeners[e]}}},{key:"multiListen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),!Array.isArray(t)||t.length===0)throw new Error("Callbacks must be a non-empty array of functions");var a=t.map(function(t){return R.listen(e,t,n)});return function(){a.forEach(function(e){return e()})}}},{key:"getLatestState",value:function e(e){return this.validateEventName(e),R.notifierState[e]}}]);return e}(),D(R,"ChangeNotifier"),y(R,"listeners",{}),y(R,"notifierState",{}),R),g=b;var O=D(function(e){return e&&Array.isArray(e)&&e.length},"isValidArray");var I=D(function(e){var t;var n="";switch((t=e.error)===null||t===void 0?void 0:t.code){case MediaError.MEDIA_ERR_ABORTED:n+=p.MEDIA_ERR_ABORTED;break;case MediaError.MEDIA_ERR_NETWORK:n+=p.MEDIA_ERR_NETWORK;break;case MediaError.MEDIA_ERR_DECODE:n+=p.MEDIA_ERR_DECODE;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:n+=p.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:n+=p.DEFAULT;break}return n},"getReadableErrorMessage"),L=D(function(e){var t;var n=e.title,a=e.album,r=e.artist,o=e.artwork,i=o?(t=o[0])===null||t===void 0?void 0:t.src:"",l=["96x96","128x128","192x192","256x256","384x384","512x512"].map(function(e){return{src:i,sizes:e,type:"image/png"}});return{title:n,album:a,artist:r,artwork:l}},"metaDataCreator"),N=0,U=D(function(e,t){var n=new Set;for(var a=0;a<e.played.length;a++){var r=e.played.start(a),o=e.played.end(a)-r;n.add(o)}var i=E(n).reduce(function(e,t){return e+t},0);N=["ENDED","TRACK_CHANGE","PAUSE"].includes(t)?i:N,g.notify("AUDIO_STATE",{currentTrackPlayTime:i,previousTrackPlayTime:N})},"calculateActualPlayedLength");var m=Object.freeze({1:"MEDIA_ERR_ABORTED",3:"MEDIA_ERR_DECODE",2:"MEDIA_ERR_NETWORK",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"});var k=g,P={LOADED_META_DATA:function(e,t){var n;console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.BUFFERING,duration:(n=t)===null||n===void 0?void 0:n.duration,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_state_".concat(e.type))},CAN_PLAY:function(e){console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.BUFFERING,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},CAN_PLAY_THROUGH:function(e){console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.READY,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},PLAY:function(e,t){var n;console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},PAUSE:function(e,t,n){var a;console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.PAUSED,progress:(a=t)===null||a===void 0?void 0:a.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&U(t,"PAUSE")},ENDED:function(e,t,n){var a;console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.ENDED,progress:(a=t)===null||a===void 0?void 0:a.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&U(t,"ENDED")},ERROR:function(e,t){var n;console.log("STATUS",e.type);var a=(n=t.error)===null||n===void 0?void 0:n.code,r=I(t);k.notify("AUDIO_STATE",{playbackState:S.ERROR,error:{code:a,message:m[a],readable:r}},"audiox_baseEvents_state_".concat(e.type))},TIME_UPDATE:function(e,t){var n;console.log("STATUS",e.type);var a=g.getLatestState("AUDIO_X_STATE");k.notify("AUDIO_STATE",{playbackState:t.paused?a.playbackState:S.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},WAITING:function(e,t){var n;console.log("STATUS",e.type),k.notify("AUDIO_STATE",{playbackState:S.BUFFERING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},VOLUME_CHANGE:function(e){console.log("STATUS",e.type),k.notify("AUDIO_STATE",{},"audiox_baseEvents_state")}};var C={ERROR:function(e,t){var n=t.type,a=t.details,r=t.fatal;console.log("STATUS",e.type),g.notify("AUDIO_STATE",{playbackState:S.ERROR,error:{type:n,isFatal:r,detail:a}},"audiox_baseEvents_state_".concat(e.type))},FRAG_CHANGED:function(){console.log("FRAG_CHANGED")}};var F=Object.freeze({ABORT:"abort",TIME_UPDATE:"timeupdate",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",PLAYING:"playing",WAITING:"waiting",SEEKING:"seeking",SEEKED:"seeked",LOADED_META_DATA:"loadedmetadata",LOADED_DATA:"loadeddata",PLAY:"play",PAUSE:"pause",RATE_CHANGE:"ratechange",VOLUME_CHANGE:"volumechange",SUSPEND:"suspend",STALLED:"stalled",PROGRESS:"progress",LOAD_START:"loadstart",ERROR:"error",TRACK_CHANGE:"trackchange"}),G={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACKS_CLEARED:"hlsSubtitleTracksCleared",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached",BACK_BUFFER_REACHED:"hlsBackBufferReached"};var M=D(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=X.getAudioInstance();O(Object.keys(e))&&Object.keys(e).forEach(function(a){var r;var o=a;(r=n)===null||r===void 0?void 0:r.addEventListener(F[o],function(r){if(a&&e[o]){var i=e[o];typeof i=="function"&&i(r,n,t)}})})},"attachDefaultEventListeners"),H=D(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=X.getAudioInstance();O(e)&&e.forEach(function(e){var a;var r=e;Object.keys(F).includes(r)&&((a=n)===null||a===void 0?void 0:a.addEventListener(F[r],function(e){g.notify(F[r],{e:e,audioInstance:n,enablePlayLog:t})}))})},"attachCustomEventListeners"),w=D(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=X.getHlsInstance();O(Object.keys(e))&&Object.keys(e).forEach(function(a){var r=a;n.on(G[r],function(a,o){if(r&&e[r]){var i=e[r];typeof i=="function"&&i(a,o,n,t)}})})},"attachHlsEventsListeners");var B=D(function(e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(L(e)))},"updateMetaData"),V=D(function(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",function(){X.getAudioInstance().play()}),navigator.mediaSession.setActionHandler("pause",function(){X.getAudioInstance().pause()}))},"attachMediaSessionHandlers");var K={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},x={playbackState:S.IDLE,duration:0,bufferedDuration:0,progress:0,volume:50,playbackRate:1,error:{code:null,message:"",readable:""},currentTrack:{},currentTrackPlayTime:0,previousTrackPlayTime:0};g.listen("AUDIO_STATE",function(e){g.notify("AUDIO_X_STATE",c({},x,e))},x);var j,Y,W=g,z,X=(z=function(){"use strict";function e(){r(this,e);var t;y(this,"_audio");y(this,"isPlayLogEnabled");if(z._instance)return console.warn("Instantiation failed: cannot create multiple instance of AudioX returning existing instance"),z._instance;if(process.env.NODE_ENV!==((t=h)===null||t===void 0?void 0:t.DEVELOPMENT)&&j)throw new Error("Cannot create multiple audio instance");z._instance=this,this._audio=new Audio}i(e,[{key:"init",value:function e(e){var t=this;return a(function(){var n,a,r,o,i,l,u,s,c,E,d,A,T,v,D;return f(this,function(f){a=e.preloadStrategy,r=a===void 0?"auto":a,o=e.autoplay,i=o===void 0?!1:o,l=e.useDefaultEventListeners,u=l===void 0?!0:l,s=e.customEventListeners,c=s===void 0?null:s,E=e.showNotificationActions,d=E===void 0?!1:E,A=e.enablePlayLog,T=A===void 0?!1:A,v=e.enableHls,D=v===void 0?!0:v;(n=t._audio)===null||n===void 0?void 0:n.setAttribute("id","audio_x_instance"),t._audio.preload=r,t._audio.autoplay=i,t.isPlayLogEnabled=T,j=t._audio,(u||c==null)&&M(P,T),d&&V(),D&&_.isSupported()&&(Y=new _,w(C,T));return[2]})})()}},{key:"addHlsMedia",value:function e(e){Y.attachMedia(j),Y.on(_.Events.MEDIA_ATTACHED,function(){Y.loadSource(e.source),console.log("hls media attached")})}},{key:"addMedia",value:function e(e){var t=this;return a(function(){var n;return f(this,function(a){n=e.source.includes(".m3u8")?"HLS":"DEFAULT";t.isPlayLogEnabled&&U(j,"TRACK_CHANGE"),e&&(n==="HLS"&&Y?t.addHlsMedia(e):(n==="HLS"&&console.error("supplied source seems to be a hls, but hls playback is not enabled"),j.src=e.source),W.notify("AUDIO_STATE",{playbackState:S.TRACK_CHANGE,currentTrackPlayTime:0,currentTrack:e}),B(e),j.load());return[2]})})()}},{key:"play",value:function e(){return a(function(){var e,t,n;return f(this,function(a){switch(a.label){case 0:t=j.src!=="";n=((e=j)===null||e===void 0?void 0:e.paused)&&j.HAVE_ENOUGH_DATA===K.HAVE_ENOUGH_DATA&&t;if(!n)return[3,2];return[4,j.play()];case 1:n=a.sent();a.label=2;case 2:n;return[2]}})})()}},{key:"addMediaAndPlay",value:function e(e){var t=this;return a(function(){return f(this,function(n){e&&t.addMedia(e).then(function(){j.HAVE_ENOUGH_DATA===K.HAVE_ENOUGH_DATA&&setTimeout(a(function(){return f(this,function(e){switch(e.label){case 0:return[4,t.play()];case 1:e.sent();return[2]}})}),950)});return[2]})})()}},{key:"pause",value:function e(){var e,t;j&&!((e=j)===null||e===void 0?void 0:e.paused)&&((t=j)===null||t===void 0?void 0:t.pause())}},{key:"stop",value:function e(){var e;j&&!j.paused&&((e=j)===null||e===void 0?void 0:e.pause(),j.currentTime=0)}},{key:"reset",value:function e(){var e=this;return a(function(){return f(this,function(t){j&&(e.stop(),j.src="",j.srcObject=null);return[2]})})()}},{key:"setVolume",value:function e(e){var t=e/100;j&&(j.volume=t,W.notify("AUDIO_STATE",{volume:e}))}},{key:"setPlaybackRate",value:function e(e){j&&(j.playbackRate=e,W.notify("AUDIO_STATE",{playbackRate:e}))}},{key:"mute",value:function e(){j&&!j.muted&&(j.muted=!0)}},{key:"seek",value:function e(e){j&&(j.currentTime=e)}},{key:"destroy",value:function e(){var e=this;return a(function(){var t;return f(this,function(n){switch(n.label){case 0:t=j;if(!t)return[3,2];return[4,e.reset()];case 1:t=(n.sent(),j.removeAttribute("src"),j.load());n.label=2;case 2:t;return[2]}})})()}},{key:"subscribe",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return W.listen(e,t,n)}},{key:"attachEventListeners",value:function e(e){H(e)}},{key:"id",get:function e(){var e;return(e=j)===null||e===void 0?void 0:e.getAttribute("id")}}],[{key:"getAudioInstance",value:function e(){return j}},{key:"getHlsInstance",value:function e(){return Y}}]);return e}(),D(z,"AudioX"),y(z,"_instance"),z);export{F as AUDIO_EVENTS,x as AUDIO_STATE,h as AUDIO_X_CONSTANTS,X as AudioX};//# sourceMappingURL=index.js.map