function e(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(t){if(Array.isArray(t))return e(t)}function n(e,t,n,r,a,i,o){try{var u=e[i](o);var c=u.value}catch(e){n(e);return}if(u.done){t(c)}else{Promise.resolve(c).then(r,a)}}function r(e){return function(){var t=this,r=arguments;return new Promise(function(a,i){var o=e.apply(t,r);function u(e){n(o,a,i,u,c,"next",e)}function c(e){n(o,a,i,u,c,"throw",e)}u(undefined)})}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function o(e,t,n){if(t)i(e.prototype,t);if(n)i(e,n);return e}function u(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function c(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};var r=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}r.forEach(function(t){u(e,t,n[t])})}return e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);if(t){r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})}n.push.apply(n,r)}return n}function d(e,t){t=t!=null?t:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(t))}else{f(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function E(e){return t(e)||c(e)||A(e)||l()}function v(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function A(t,n){if(!t)return;if(typeof t==="string")return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(r);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,n)}function y(e,t){var n,r,a,i,o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function u(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(a=i[0]&2?r["return"]:i[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;if(r=0,a)i=[i[0]&2,a.value];switch(i[0]){case 0:case 1:a=i;break;case 4:o.label++;return{value:i[1],done:false};case 5:o.label++;r=i[1];i=[0];continue;case 7:i=o.ops.pop();o.trys.pop();continue;default:if(!(a=o.trys,a=a.length>0&&a[a.length-1])&&(i[0]===6||i[0]===2)){o=0;continue}if(i[0]===3&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(i[0]===6&&o.label<a[1]){o.label=a[1];a=i;break}if(a&&o.label<a[2]){o.label=a[2];o.ops.push(i);break}if(a[2])o.ops.pop();o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e];r=0}finally{n=a=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}}var _=Object.defineProperty;var p=function(e,t,n){return t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var b=function(e,t){return _(e,"name",{value:t,configurable:!0})};var T=function(e,t,n){return p(e,(typeof t==="undefined"?"undefined":v(t))!="symbol"?t+"":t,n),n};var D=Object.freeze({REACT:"REACT",VANILLA:"VANILLA",DEVELOPMENT:"development"}),O=Object.freeze({BUFFERING:"buffering",PLAYING:"playing",PAUSED:"paused",READY:"ready",IDLE:"idle",ENDED:"ended",STALLED:"stalled",ERROR:"error"}),m=Object.freeze({MEDIA_ERR_ABORTED:"The user canceled the audio.",MEDIA_ERR_DECODE:"An error occurred while decoding the audio.",MEDIA_ERR_NETWORK:"A network error occurred while fetching the audio.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The audio is missing or is in a format not supported by your browser.",DEFAULT:"An unknown error occurred."});var h,S=(h=function(){"use strict";function e(){a(this,e)}o(e,null,[{key:"validateEventName",value:function e(e){if(!e||typeof e!="string")throw new Error("Invalid event name")}},{key:"notify",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"audiox_notifier_default";this.validateEventName(e);var r=h.listeners[e];r&&t!==null&&(h.notifierState[e]=s({},h.notifierState[e]||{},t),r.forEach(function(t){t(h.notifierState[e])}))}},{key:"listen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),typeof t!="function")throw new Error("Callback must be a function");return h.listeners[e]?h.listeners[e].add(t):(h.notifierState[e]=n,h.listeners[e]=new Set([t])),function(){var n=h.listeners[e];n&&(n.delete(t),n.size===0&&delete h.listeners[e])}}},{key:"multiListen",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.validateEventName(e),!Array.isArray(t)||t.length===0)throw new Error("Callbacks must be a non-empty array of functions");var r=t.map(function(t){return h.listen(e,t,n)});return function(){r.forEach(function(e){return e()})}}},{key:"getLatestState",value:function e(e){return this.validateEventName(e),h.notifierState[e]}}]);return e}(),b(h,"ChangeNotifier"),T(h,"listeners",{}),T(h,"notifierState",{}),h),g=S;var R=b(function(e){return e&&Array.isArray(e)&&e.length},"isValidArray");var I=b(function(e){var t;var n="";switch((t=e.error)===null||t===void 0?void 0:t.code){case MediaError.MEDIA_ERR_ABORTED:n+=m.MEDIA_ERR_ABORTED;break;case MediaError.MEDIA_ERR_NETWORK:n+=m.MEDIA_ERR_NETWORK;break;case MediaError.MEDIA_ERR_DECODE:n+=m.MEDIA_ERR_DECODE;break;case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:n+=m.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:n+=m.DEFAULT;break}return n},"getReadableErrorMessage"),k=b(function(e){var t;var n=e.title,r=e.album,a=e.artist,i=e.artwork,o=i?(t=i[0])===null||t===void 0?void 0:t.src:"",u=["96x96","128x128","192x192","256x256","384x384","512x512"].map(function(e){return{src:o,sizes:e,type:"image/png"}});return{title:n,album:r,artist:a,artwork:u}},"metaDataCreator"),P=0,N=b(function(e,t){var n=new Set;for(var r=0;r<e.played.length;r++){var a=e.played.start(r),i=e.played.end(r)-a;n.add(i)}var o=E(n).reduce(function(e,t){return e+t},0);P=t==="ENDED"?o:P,g.notify("AUDIO_STATE",{currentTrackPlayTime:o,previousTrackPlayTime:P})},"calculateActualPlayedLength");var U=Object.freeze({1:"MEDIA_ERR_ABORTED",3:"MEDIA_ERR_DECODE",2:"MEDIA_ERR_NETWORK",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"});var w=g,L={LOADED_META_DATA:function(e,t,n){var r;w.notify("AUDIO_STATE",{playbackState:O.BUFFERING,duration:(r=t)===null||r===void 0?void 0:r.duration,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_state_".concat(e.type)),n&&N(t,"PAUSE")},CAN_PLAY:function(e,t,n){w.notify("AUDIO_STATE",{playbackState:O.BUFFERING,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&N(t,"PAUSE")},CAN_PLAY_THROUGH:function(e,t,n){w.notify("AUDIO_STATE",{playbackState:O.READY,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&N(t,"PAUSE")},PLAY:function(e,t){var n;w.notify("AUDIO_STATE",{playbackState:O.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},PAUSE:function(e,t,n){var r;w.notify("AUDIO_STATE",{playbackState:O.PAUSED,progress:(r=t)===null||r===void 0?void 0:r.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&N(t,"PAUSE")},ENDED:function(e,t,n){var r;w.notify("AUDIO_STATE",{playbackState:O.ENDED,progress:(r=t)===null||r===void 0?void 0:r.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type)),n&&N(t,"ENDED")},ERROR:function(e,t,n){var r;var a=(r=t.error)===null||r===void 0?void 0:r.code,i=I(t);w.notify("AUDIO_STATE",{playbackState:O.PAUSED,error:{code:a,message:U[a],readable:i}},"audiox_baseEvents_state_".concat(e.type)),n&&N(t,"ERROR")},TIME_UPDATE:function(e,t){var n;w.notify("AUDIO_STATE",{playbackState:t.paused?O.IDLE:O.PLAYING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},WAITING:function(e,t){var n;w.notify("AUDIO_STATE",{playbackState:O.BUFFERING,progress:(n=t)===null||n===void 0?void 0:n.currentTime,error:{code:null,message:"",readable:""}},"audiox_baseEvents_state_".concat(e.type))},VOLUME_CHANGE:function(e){w.notify("AUDIO_STATE",{},"audiox_baseEvents_state")}};var M=Object.freeze({ABORT:"abort",TIME_UPDATE:"timeupdate",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",PLAYING:"playing",WAITING:"waiting",SEEKING:"seeking",SEEKED:"seeked",LOADED_META_DATA:"loadedmetadata",LOADED_DATA:"loadeddata",PLAY:"play",PAUSE:"pause",RATE_CHANGE:"ratechange",VOLUME_CHANGE:"volumechange",SUSPEND:"suspend",STALLED:"stalled",PROGRESS:"progress",LOAD_START:"loadstart",ERROR:"error"});var j=b(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=z.getAudioInstance();R(Object.keys(e))&&Object.keys(e).forEach(function(r){var a;var i=r;(a=n)===null||a===void 0?void 0:a.addEventListener(M[i],function(a){if(r&&e[i]){var o=e[i];typeof o=="function"&&o(a,n,t)}})})},"attachDefaultEventListeners"),C=b(function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var n=z.getAudioInstance();R(e)&&e.forEach(function(e){var r;var a=e;Object.keys(M).includes(a)&&((r=n)===null||r===void 0?void 0:r.addEventListener(M[a],function(e){g.notify(M[a],{e:e,audioInstance:n,enablePlayLog:t})}))})},"attachCustomEventListeners");var H=b(function(e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata(k(e)))},"updateMetaData"),G=b(function(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",function(){z.getAudioInstance().play()}),navigator.mediaSession.setActionHandler("pause",function(){z.getAudioInstance().pause()}))},"attachMediaSessionHandlers");var x={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},V={playbackState:O.IDLE,duration:0,bufferedDuration:0,progress:0,volume:50,playbackRate:1,error:{code:null,message:"",readable:""},currentTrack:{},currentTrackPlayTime:0,previousTrackPlayTime:0};g.listen("AUDIO_STATE",function(e){g.notify("AUDIO_X_STATE",s({},V,e))},V);var Y,F=g,B,z=(B=function(){"use strict";function e(){a(this,e);var t;T(this,"_audio");if(B._instance)return B._instance;if(process.env.NODE_ENV!==((t=D)===null||t===void 0?void 0:t.DEVELOPMENT)&&Y)throw new Error("Cannot create multiple audio instance");B._instance=this,this._audio=new Audio}o(e,[{key:"init",value:function e(e){var t=this;return r(function(){var n,r,a,i,o,u,c,l,s,f,d,E,v;return y(this,function(A){r=e.preloadStrategy,a=r===void 0?"auto":r,i=e.autoplay,o=i===void 0?!1:i,u=e.useDefaultEventListeners,c=u===void 0?!0:u,l=e.customEventListeners,s=l===void 0?null:l,f=e.showNotificationActions,d=f===void 0?!1:f,E=e.enablePlayLog,v=E===void 0?!1:E;(n=t._audio)===null||n===void 0?void 0:n.setAttribute("id","audio_x_instance"),t._audio.preload=a,t._audio.autoplay=o,Y=t._audio,(c||s==null)&&j(L,v),d&&G();return[2]})})()}},{key:"addMedia",value:function e(e){return r(function(){return y(this,function(t){e&&(Y.src=e.source,F.notify("AUDIO_STATE",d(s({},V),{currentTrack:e})),H(e),Y.load());return[2]})})()}},{key:"play",value:function e(){return r(function(){var e,t,n;return y(this,function(r){switch(r.label){case 0:t=Y.src!=="";n=((e=Y)===null||e===void 0?void 0:e.paused)&&Y.HAVE_ENOUGH_DATA===x.HAVE_ENOUGH_DATA&&t;if(!n)return[3,2];return[4,Y.play()];case 1:n=r.sent();r.label=2;case 2:n;return[2]}})})()}},{key:"addMediaAndPlay",value:function e(e){var t=this;return r(function(){return y(this,function(n){e&&t.addMedia(e).then(function(){Y.HAVE_ENOUGH_DATA===x.HAVE_ENOUGH_DATA&&setTimeout(r(function(){return y(this,function(e){switch(e.label){case 0:return[4,t.play()];case 1:e.sent();return[2]}})}),950)});return[2]})})()}},{key:"pause",value:function e(){var e,t;Y&&!((e=Y)===null||e===void 0?void 0:e.paused)&&((t=Y)===null||t===void 0?void 0:t.pause())}},{key:"stop",value:function e(){var e;Y&&!Y.paused&&((e=Y)===null||e===void 0?void 0:e.pause(),Y.currentTime=0)}},{key:"reset",value:function e(){var e=this;return r(function(){return y(this,function(t){Y&&(e.stop(),Y.src="",Y.srcObject=null);return[2]})})()}},{key:"setVolume",value:function e(e){var t=e/100;Y&&(Y.volume=t,F.notify("AUDIO_STATE",d(s({},V),{volume:e})))}},{key:"setPlaybackRate",value:function e(e){Y&&(Y.playbackRate=e,F.notify("AUDIO_STATE",d(s({},V),{playbackRate:e})))}},{key:"mute",value:function e(){Y&&!Y.muted&&(Y.muted=!0)}},{key:"seek",value:function e(e){Y&&(Y.currentTime=e)}},{key:"destroy",value:function e(){var e=this;return r(function(){var t;return y(this,function(n){switch(n.label){case 0:t=Y;if(!t)return[3,2];return[4,e.reset()];case 1:t=(n.sent(),Y.removeAttribute("src"),Y.load());n.label=2;case 2:t;return[2]}})})()}},{key:"subscribe",value:function e(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return F.listen(e,t,n)}},{key:"attachEventListeners",value:function e(e){C(e)}},{key:"enablePlayLog",value:function e(){N(Y)}},{key:"id",get:function e(){var e;return(e=Y)===null||e===void 0?void 0:e.getAttribute("id")}},{key:"media",set:function e(e){var t;Y&&(Y.src=(t=e)===null||t===void 0?void 0:t.source)}}],[{key:"getAudioInstance",value:function e(){return Y}}]);return e}(),b(B,"AudioX"),T(B,"_instance"),B);export{M as AUDIO_EVENTS,V as AUDIO_STATE,D as AUDIO_X_CONSTANTS,z as AudioX};//# sourceMappingURL=index.js.map